<div class="container">
  <h2>Company Details</h2>

  <button class="btn" (click)="openModal()">Add New Company</button>

  <table class="table">
    <thead>
      <tr>
        <th>Company ID</th>
        <th>Company Name</th>
        <th>Email</th>
        <th>Address</th>
        <th>Phone Number</th>
        <th>Company Logo</th>
        <th>Manager Name</th>
        <th>Manager Profile</th>
        <th>Update Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let company of companies">
        <td>{{ company.companyId }}</td>
        <td>{{ company.companyName }}</td>
        <td>{{ company.email }}</td>
        <td>{{ company.address }}</td>
        <td>{{ company.phoneNumber }}</td>
        <td><img [src]="'https://localhost:7149/' + company.logoImage" alt="Logo" width="50" height="50"></td>
        <td>{{ company.managerName }}</td>
        <td><img [src]="'https://localhost:7149/' + company.profileImage" alt="Profile" width="50" height="50"></td>
        <td>{{ company.updateDate ? (company.updateDate | date: 'short') : 'Not Updated' }}</td>
        <td>
          <button class="btn btn-link p-0" (click)="openEditModal(company)">
            <i class="fa fa-edit text-primary"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Modal for adding new company details -->
  <div *ngIf="isModalOpen" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h5>Add New Company Details</h5>
        <button class="close-btn" (click)="closeModal()">X</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="addForm" (ngSubmit)="onSubmit()">
          <div class="mb-3">
            <label for="companyName" class="form-label">Company Name</label>
            <input id="companyName" class="form-control" formControlName="companyName" />
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input id="email" type="email" class="form-control" formControlName="email" />
          </div>
          <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <input id="address" class="form-control" formControlName="address" />
          </div>
          <div class="mb-3">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input id="phoneNumber" class="form-control" formControlName="phoneNumber" />
          </div>
          <div class="mb-3">
            <label for="logoImage" class="form-label">Company Logo</label>
            <input id="logoImage" type="file" class="form-control" (change)="onFileChange($event, 'logoImage')" />
          </div>
          <div class="mb-3">
            <label for="managerName" class="form-label">Manager Name</label>
            <input id="managerName" class="form-control" formControlName="managerName" />
          </div>
          <div class="mb-3">
            <label for="profileImage" class="form-label">Manager Profile Image</label>
            <input id="profileImage" type="file" class="form-control" (change)="onFileChange($event, 'profileImage')" />
          </div>

          <div *ngIf="uploadProgress > 0" class="progress mt-3">
            <div class="progress-bar" role="progressbar" [style.width]="uploadProgress + '%'"
              aria-valuenow="uploadProgress" aria-valuemin="0" aria-valuemax="100">
              {{ uploadProgress }}%
            </div>
          </div>

          <button type="submit" class="btn btn-primary" [disabled]="addForm.invalid">Submit</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal for editing company details -->
  <div *ngIf="isEditModalOpen" class="modal-overlay" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h5>Edit Company Details</h5>
        <button class="close-btn" (click)="closeEditModal()">X</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="editForm" (ngSubmit)="onEditSubmit()">
          <div class="mb-3">
            <label for="companyName" class="form-label">Company Name</label>
            <input id="companyName" class="form-control" formControlName="companyName" />
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input id="email" type="email" class="form-control" formControlName="email" />
          </div>
          <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <input id="address" class="form-control" formControlName="address" />
          </div>
          <div class="mb-3">
            <label for="phoneNumber" class="form-label">Phone Number</label>
            <input id="phoneNumber" class="form-control" formControlName="phoneNumber" />
          </div>
          <div class="mb-3">
            <label for="logoImage" class="form-label">Company Logo</label>
            <input id="logoImage" type="file" class="form-control" (change)="onFileChange($event, 'logoImage')" />
          </div>
          <div class="mb-3">
            <label for="managerName" class="form-label">Manager Name</label>
            <input id="managerName" class="form-control" formControlName="managerName" />
          </div>
          <div class="mb-3">
            <label for="profileImage" class="form-label">Manager Profile Image</label>
            <input id="profileImage" type="file" class="form-control" (change)="onFileChange($event, 'profileImage')" />
          </div>
          <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid">Submit</button>
        </form>
      </div>
    </div>
  </div>
</div>